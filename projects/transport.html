<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calculateur de trajets - projet d'Ã©cole</title>
  <link rel="stylesheet" href="../style.css">
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

  <style>
    .terminal-box {
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.02));
      border: 1px solid rgba(102,252,241,0.12);
      border-radius: 12px;
      padding: 18px;
      height: 420px;
      overflow-y: auto;
      box-shadow: 0 0 18px rgba(102,252,241,0.15);
      color: #dffefe;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }

    #input-field {
      width: 100%;
      margin-top: 14px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(102,252,241,0.25);
      background: var(--card);
      color: var(--accent);
      font-family: 'Courier New', monospace;
      font-size: 16px;
    }

    #input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 12px rgba(102,252,241,0.3);
    }

    .prompt {
      color: var(--accent);
    }
  </style>
</head>

<body>

<!-- ======== FOND MATRIX ======== -->
<canvas id="canvas"></canvas>
<canvas id="canvas2"></canvas>
<script src="../background.js"></script>
<!-- ============================= -->

<main class="section container">

  <h1 style="color:var(--accent);">Calculateur de trajets</h1>

  <p class="muted">
    Projet rÃ©alisÃ© en deuxiÃ¨me annÃ©e post-bac (<strong>Maths SpÃ© â€“ Bac +2</strong>) dans un module de mathÃ©matiques appliquÃ©es
    portant sur les graphes, les rÃ©seaux et l'algorithme de Dijkstra.
  </p>

  <hr style="opacity:0.15; margin:40px 0;">

  <h2 style="color:var(--accent);">ğŸ“‹ Description du projet</h2>
  
  <p>
    Ce programme permet de calculer le trajet optimal entre deux stations de mÃ©tro dans 4 villes franÃ§aises : 
    <strong>Paris, Lyon, Lille et Bordeaux</strong>. Il utilise l'algorithme de Dijkstra pour trouver le chemin le plus rapide
    en tenant compte des correspondances et des distances rÃ©elles entre les stations.
  </p>

  <div class="detail">
    <h3>FonctionnalitÃ©s principales</h3>
    <p>
      â€¢ Calcul du trajet optimal entre deux stations<br>
      â€¢ Estimation du temps de trajet en fonction du type de ligne (mÃ©tro/tram)<br>
      â€¢ Prise en compte des temps de correspondance<br>
      â€¢ Suggestions de stations similaires en cas d'erreur de saisie<br>
      â€¢ Support de 4 rÃ©seaux de transport urbain
    </p>
  </div>

  <div class="detail">
    <h3>ğŸ”§ Technologies utilisÃ©es</h3>
    <p>
      â€¢ <strong>Python</strong> : langage principal du projet<br>
      â€¢ <strong>Algorithme de Dijkstra</strong> : recherche du plus court chemin<br>
      â€¢ <strong>Formule de Haversine</strong> : calcul des distances gÃ©ographiques<br>
      â€¢ <strong>Structure de graphes</strong> : reprÃ©sentation du rÃ©seau de transport
    </p>
  </div>

  <div class="detail">
    <h3>Ce que j'ai appris</h3>
    <p>
      Ce projet m'a particuliÃ¨rement intÃ©ressÃ© car il m'a permis de comprendre concrÃ¨tement l'application des graphes 
      et des algorithmes de recherche de chemin dans un contexte rÃ©el. J'ai appris Ã  optimiser les calculs de distance,
      Ã  structurer des donnÃ©es complexes (rÃ©seaux de transport), et Ã  gÃ©rer les erreurs utilisateur de maniÃ¨re intelligente
      avec la recherche dichotomique et les suggestions de stations similaires.
    </p>
  </div>

  <hr style="opacity:0.15; margin:40px 0;">

  <h2 style="color:var(--accent);">DÃ©monstration â€“ Terminal interactif</h2>

  <div id="terminal" class="terminal-box"></div>
  <input id="input-field" placeholder="Entrez une commande puis appuyez sur EntrÃ©eâ€¦" autocomplete="off">

</main>

<script>

let py;
let waitingInput = false;
let inputResolve = null;

// Initialisation Pyodide
(async () => {
  try {
    py = await loadPyodide();

    // Configuration de stdin APRÃˆS le chargement
    py.setStdin({
      readline() {
        return new Promise(resolve => {
          waitingInput = true;
          inputResolve = resolve;
        });
      }
    });

    // CHARGEMENT APP3.PY
    const script = await (await fetch("../data/app3/APP3.py")).text();
    py.runPython(script);

    // Charger les CSV
    const files = ["paris_v4.csv", "lille.csv", "lyon.csv", "bordeaux.csv"];
    for (let f of files) {
      try {
        const txt = await (await fetch("../data/app3/" + f)).text();
        py.FS.writeFile(f, txt);
      } catch(e) {
        print("âš ï¸ CSV manquant : " + f + "\n");
      }
    }

    print("ğŸš‡ Transport CLI â€“ Projet Maths SpÃ© (Bac +2)\n");
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n");
    print("Tapez `run` pour lancer le programme.\n\n");
  } catch(e) {
    print("âŒ Erreur d'initialisation : " + e + "\n");
  }
})();

// Print helper
function print(text) {
  const term = document.getElementById("terminal");
  term.innerHTML += text.replace(/\n/g, "<br>");
  term.scrollTop = term.scrollHeight;
}

// Configuration de stdin sera faite aprÃ¨s le chargement

// Commandes utilisateur
document.getElementById("input-field").addEventListener("keydown", async (e) => {
  if (e.key === "Enter") {
    const v = e.target.value;
    e.target.value = "";

    print(`<span class="prompt">$</span> ${v}\n`);

    if (waitingInput) {
      waitingInput = false;
      inputResolve(v);
      return;
    }

    if (v.trim() === "run") {
      print("Lancement du programme...\n\n");
      try {
        await py.runPythonAsync("Menu()");
      } catch(e) {
        print("âŒ Erreur d'exÃ©cution Python : " + e + "\n");
      }
    } else if (v.trim() === "clear") {
      document.getElementById("terminal").innerHTML = "";
    } else if (v.trim() === "help") {
      print("Commandes disponibles :\n");
      print("  run   - Lance le calculateur de trajets\n");
      print("  clear - Efface le terminal\n");
      print("  help  - Affiche cette aide\n\n");
    } else if (v.trim() !== "") {
      print(`Commande inconnue : '${v}'. Tapez 'help' pour voir les commandes disponibles.\n\n`);
    }
  }
});

// Focus automatique sur l'input
document.getElementById("input-field").focus();
</script>
</body>
</html>