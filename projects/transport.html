<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Transport ‚Äì Calculateur de trajets (Projet d'√©cole)</title>
  <link rel="stylesheet" href="../style.css">

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

  <style>
    body {
      background: #000;
      color: #0ef;
      font-family: monospace;
    }

    #terminal {
      width: 90%;
      height: 500px;
      background: #0a0a0a;
      margin: 30px auto;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #0ef;
      overflow-y: auto;
      font-size: 18px;
      line-height: 1.5;
      box-shadow: 0 0 15px #0ef4;
    }

    .prompt {
      color: #0ef;
    }

    #input-field {
      width: 90%;
      display: block;
      margin: 0 auto;
      margin-top: 15px;
      padding: 10px;
      background: #000;
      border: 1px solid #0ef;
      color: #0ef;
      font-size: 18px;
      border-radius: 6px;
      font-family: monospace;
    }

    .section-container {
      width: 90%;
      margin: 50px auto;
    }
  </style>
</head>

<body>

  <section class="section-container">
    <h1 style="color:#0ef;">Projet Transport ‚Äì Calculateur de trajets</h1>

    <p class="muted">
      Ce projet a √©t√© r√©alis√© lors de ma deuxi√®me ann√©e post-bac (<strong>Maths Sp√© ‚Äì Bac +2</strong>) dans le cadre d‚Äôun module m√™lant
      math√©matiques appliqu√©es, graphes et algorithmique.  
      L‚Äôobjectif consistait √† mod√©liser un r√©seau de transports (m√©tro/tram) sous forme de graphe pond√©r√©, puis √† impl√©menter
      un algorithme permettant de calculer le plus court chemin entre deux stations, en tenant compte :
      <br><br>
      ‚Ä¢ des temps de trajet entre stations  
      ‚Ä¢ des correspondances  
      ‚Ä¢ de la ville s√©lectionn√©e (Paris, Lyon, Lille ou Bordeaux)  
      <br>
      Ce travail a demand√© la manipulation de fichiers CSV, la cr√©ation d‚Äôun dictionnaire de stations,
      la compr√©hension du fonctionnement de Dijkstra et la gestion d‚Äôun interface utilisateur en ligne de commande.
    </p>

    <p class="muted">
      Sur cette page, vous pouvez tester directement le programme Python original, ex√©cut√© dans votre navigateur gr√¢ce √† Pyodide.
    </p>

    <hr style="border-color:#0ef4; margin:40px 0;">

    <h2 style="color:#0ef;">üíª D√©monstration ‚Äì Terminal interactif</h2>
    <p class="muted">
      Tapez <code>run</code> pour lancer le programme, puis suivez les instructions comme dans un vrai terminal.
    </p>

    <div id="terminal"></div>
    <input id="input-field" placeholder="Tape une commande ici puis Enter‚Ä¶">
  </section>

<script>

let py;
let awaitingInput = false;
let inputResolver = null;

// ====== INITIALISATION ======
(async () => {
  py = await loadPyodide();

  // Charger ton code APP3.py
  const code = await (await fetch("../data/app3/APP3.py")).text();
  py.runPython(code);

  // Charger les CSV dans le FS virtuel
  const files = ["paris_v4.csv", "lille.csv", "lyon.csv", "bordeaux.csv"];
  for (let f of files) {
    const content = await (await fetch("../data/app3/" + f)).text();
    py.FS.writeFile(f, content);
  }

  printToTerminal("Transport ‚Äì Projet Maths Sp√© (Bac +2)\n");
  printToTerminal("Python 3.11 (Pyodide)\n");
  printToTerminal("Tape `run` pour lancer le programme.\n\n");
})();

// ====== AFFICHAGE TERMINAL ======
function printToTerminal(text) {
  const term = document.getElementById("terminal");
  term.innerHTML += text.replace(/\n/g, "<br>");
  term.scrollTop = term.scrollHeight;
}

// ====== SIMULATION DE input() ======
py.setStdin({
  readline() {
    return new Promise(resolve => {
      awaitingInput = true;
      inputResolver = resolve;
    });
  }
});

// ====== GESTION DES COMMANDES UTILISATEUR ======
document.getElementById("input-field").addEventListener("keydown", async (event) => {
  if (event.key === "Enter") {
    const userInput = event.target.value;
    event.target.value = "";

    printToTerminal(`<span class='prompt'>$ </span>${userInput}\n`);

    if (awaitingInput) {
      awaitingInput = false;
      inputResolver(userInput);
      return;
    }

    // Lancer APP3
    if (userInput.trim() === "run") {
      printToTerminal("Lancement du programme...\n\n");
      try {
        await py.runPythonAsync("Menu()");
      } catch (e) {
        printToTerminal("[Erreur Python] " + e + "\n");
      }
    }
  }
});
</script>

</body>
</html>
