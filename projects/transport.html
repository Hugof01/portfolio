<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Projet Transport ‚Äì Calculateur de trajets</title>
  <link rel="stylesheet" href="../style.css">
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

  <style>
    .terminal-box {
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.02));
      border: 1px solid rgba(102,252,241,0.12);
      border-radius: 12px;
      padding: 18px;
      height: 420px;
      overflow-y: auto;
      box-shadow: 0 0 18px rgba(102,252,241,0.15);
      color: #dffefe;
      font-family: monospace;
    }

    #input-field {
      width: 100%;
      margin-top: 14px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(102,252,241,0.25);
      background: var(--card);
      color: var(--accent);
      font-family: monospace;
      font-size: 16px;
    }
  </style>
</head>

<body>

<!-- ======== FOND MATRIX ======== -->
<canvas id="canvas"></canvas>
<canvas id="canvas2"></canvas>
<script src="../background.js"></script>
<!-- ============================= -->

<main class="section container">

  <h1 style="color:var(--accent);">Projet Transport ‚Äî Calculateur de trajets</h1>

  <p class="muted">
    Projet r√©alis√© en deuxi√®me ann√©e post-bac (<strong>Maths Sp√© ‚Äì Bac +2</strong>) dans un module de math√©matiques appliqu√©es
    portant sur les graphes, les r√©seaux et l‚Äôalgorithme de Dijkstra.
  </p>

  <hr style="opacity:0.15; margin:40px 0;">

  <h2 style="color:var(--accent);">üíª D√©monstration ‚Äî Terminal interactif</h2>

  <div id="terminal" class="terminal-box"></div>
  <input id="input-field" placeholder="Entrez une commande puis appuyez sur Entr√©e‚Ä¶">

</main>

<script>

let py;
let waitingInput = false;
let inputResolve = null;

// Initialisation Pyodide
(async () => {
  py = await loadPyodide();

  // CHARGEMENT APP3.PY
  try {
    const script = await (await fetch("../data/app3/APP3.py")).text();
    py.runPython(script);
  } catch(e) {
    print("‚ùå Erreur : Impossible de charger APP3.py\n" + e);
    return;
  }

  // Charger les CSV
  const files = ["paris_v4.csv", "lille.csv", "lyon.csv", "bordeaux.csv"];
  for (let f of files) {
    try {
      const txt = await (await fetch("../data/app3/" + f)).text();
      py.FS.writeFile(f, txt);
    } catch(e) {
      print("‚ùå CSV manquant : " + f + "\n");
    }
  }

  print("Transport CLI ‚Äì Projet Maths Sp√© (Bac +2)\n");
  print("Tapez `run` pour lancer le programme.\n\n");
})();

// Print helper
function print(text) {
  const term = document.getElementById("terminal");
  term.innerHTML += text.replace(/\n/g, "<br>");
  term.scrollTop = term.scrollHeight;
}

// input()
py.setStdin({
  readline() {
    return new Promise(resolve => {
      waitingInput = true;
      inputResolve = resolve;
    });
  }
});

// Commandes utilisateur
document.getElementById("input-field").addEventListener("keydown", async (e) => {
  if (e.key === "Enter") {
    const v = e.target.value;
    e.target.value = "";

    print(`<span style="color:var(--accent);">$</span> ${v}\n`);

    if (waitingInput) {
      waitingInput = false;
      inputResolve(v);
      return;
    }

    if (v.trim() === "run") {
      print("Lancement du programme...\n\n");
      try {
        await py.runPythonAsync("Menu()");
      } catch(e) {
        print("‚ùå Erreur d'ex√©cution Python : " + e);
      }
    }
  }
});
</script>

</body>
</html>
